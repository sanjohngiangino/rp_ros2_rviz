# RP ROS2 RViz Clone

This project provides ROS 2 nodes to visualize and control a mobile robot, via an RViz Clone.
Robot Programming 2024-2025
Marcelo 1850518

## Overview

The package `rp_ros2_rviz` includes the following executable nodes:

* **world\_node**: Publishes scan, odom,robot position and handle the cv.
* **controller\_node**: Handles the switch from path generated and manual movement, and handle the path generated by the path planner.
* **pathplanner\_node**: Computes paths based on (based on [rp\_09\_dmap\_planner](https://gitlab.com/grisetti/robotprogramming_2024_25/-/tree/main/source/rp_09_dmap_planner)).
* **mapserver**: Serves the occupancy grid map (requires a `map_path` parameter).
* **particle\_node\_filter**: Implements a particle filter for localization from odom and laserscan receveid by the gui(world).

## Setup & Build

1. Clone the repository to your workspace:

   ```bash
   cd ~/ros2_ws/src
   git clone https://github.com/sanjohngiangino/rp_ros2_rviz.git
   ```

2. Build the package:

   ```bash
   cd ~/ros2_ws
   colcon build --packages-select rp_ros2_rviz
   ```

3. Source the workspace:

   ```bash
   source install/setup.bash
   ```

## Running the Nodes

### 1. Using the Python Launch File

You can start all nodes at once with the provided launch file:

```bash
ros2 launch rp_ros2_rviz combined_launcher.py
```

This launch file starts:

* `world_node`
* `controller_node`
* `pathplanner_node`
* `mapserver` (with `map_path` parameter)
* `particle_node_filter`
* `initial position of the robot after 5 sec (10,10)`

**Example:**

```bash
ros2 launch rp_ros2_rviz combined_launcher.py \
  mapserver:='--ros-args -p map_path:=*/rp_ros2_rviz/map/labirinto.png'
```

### 2. Running Nodes Individually

Alternatively, you can run each node separately:

```bash
ros2 run rp_ros2_rviz world_node
ros2 run rp_ros2_rviz controller_node
ros2 run rp_ros2_rviz pathplanner_node
ros2 run rp_ros2_rviz mapserver --ros-args -p map_path:=*/rp_ros2_rviz/map/labirinto.png
ros2 run rp_ros2_rviz particle_node_filter
```

## Publishing Initial Pose and Goal

After starting the nodes,you can  send a single initial pose and goal from the terminal:

```bash
# Publish initial pose once
ros2 topic pub --once /initialpose geometry_msgs/Pose "
position:
  x: 300.0
  y: 200.0
  z: 0.0
orientation:
  x: 0.0
  y: 0.0
  z: 0.0
  w: 1.0
"

# Publish goal point once
ros2 topic pub --once /move_base/goal geometry_msgs/Point "{x: 300.0, y: 200.0, z: 0.0}"
```

## Controlling the Robot

Once the project is running you can move the robot using one of three methods:

1. **Keyboard (WASD):**

   * Press **W**/**S** to move forward/backward.
   * Press **A**/**D** to move left/right.

2. **Goal Click:**

   * Click directly on the map window to set a new goal. The robot will stop any current plan and navigate to the clicked point.

3. **ROS 2 Topic Publish:**
   Send a single goal point via command line:

   ```bash
   ros2 topic pub --once /move_base/goal geometry_msgs/Point "{x: 300.0, y: 200.0, z: 0.0}"
   ```
